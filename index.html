<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>LifeDashboard</title>
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css"
  />
  <style>
    /* ダッシュボード全体レイアウト */
    .dashboard {
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 240px;
      border-right: 1px solid #ddd;
      background-color: #fff;
    }
    .content {
      flex: 1;
      overflow-y: auto;
      background-color: #f9f9f9;
    }
    /* アクティブタブの下線 */
    .tabs.is-toggle li.is-active a {
      border-bottom-color: #3273dc;
      color: #3273dc;
    }
    /* Markdownプレビューの基本スタイル */
    .markdown-rendered h1,
    .markdown-rendered h2,
    .markdown-rendered h3 {
      margin-top: 1em;
    }
    .markdown-rendered ul {
      margin-left: 1em;
    }
  </style>
</head>
<body>
  <!-- ナビゲーションバー -->
  <nav class="navbar is-light" role="navigation">
    <div class="navbar-brand">
      <a class="navbar-item" href="#">📘 LifeDashboard</a>
    </div>
  </nav>

  <div class="dashboard">
    <!-- サイドバー -->
    <aside class="menu sidebar">
      <p class="menu-label">メニュー</p>
      <ul class="menu-list">
        <li><a class="is-active" data-target="dashboard">ダッシュボード</a></li>
        <li><a data-target="diary">日記</a></li>
        <li><a data-target="study">勉強</a></li>
        <li><a data-target="work">仕事</a></li>
        <li><a data-target="schedule">予定</a></li>
        <li><a data-target="settings">設定</a></li>
      </ul>
    </aside>

    <!-- メインコンテンツ -->
    <main class="content">
      <!-- Dashboard セクション -->
      <section id="dashboard" class="section">
        <h2 class="title is-4">🏠 ダッシュボード</h2>
        <p>ここに各種ウィジェットや概要を表示します。</p>
      </section>

      <!-- ノート系セクション：日記・勉強・仕事・予定 -->
      <!-- 共通クラス note-section と data-category 属性で初期化を共通化 -->
      <section id="diary" class="section is-hidden note-section" data-category="diary">
        <h2 class="title is-4">📔 日記</h2>
        <div class="tabs is-toggle is-fullwidth">
          <ul>
            <li class="is-active"><a data-action="write">入力</a></li>
            <li><a data-action="preview">プレビュー</a></li>
          </ul>
        </div>
        <div class="editor-pane">
          <textarea class="markdown-editor textarea" rows="12" placeholder="日記をMarkdownで書く..."></textarea>
        </div>
        <div class="preview-pane box is-hidden">
          <div class="markdown-rendered"></div>
        </div>
      </section>

      <section id="study" class="section is-hidden note-section" data-category="study">
        <h2 class="title is-4">📚 勉強</h2>
        <div class="tabs is-toggle is-fullwidth">
          <ul>
            <li class="is-active"><a data-action="write">入力</a></li>
            <li><a data-action="preview">プレビュー</a></li>
          </ul>
        </div>
        <div class="editor-pane">
          <textarea class="markdown-editor textarea" rows="12" placeholder="勉強メモをMarkdownで..."></textarea>
        </div>
        <div class="preview-pane box is-hidden">
          <div class="markdown-rendered"></div>
        </div>
      </section>

      <section id="work" class="section is-hidden note-section" data-category="work">
        <h2 class="title is-4">💼 仕事</h2>
        <div class="tabs is-toggle is-fullwidth">
          <ul>
            <li class="is-active"><a data-action="write">入力</a></li>
            <li><a data-action="preview">プレビュー</a></li>
          </ul>
        </div>
        <div class="editor-pane">
          <textarea class="markdown-editor textarea" rows="12" placeholder="仕事のタスクやログを..."></textarea>
        </div>
        <div class="preview-pane box is-hidden">
          <div class="markdown-rendered"></div>
        </div>
      </section>

      <section id="schedule" class="section is-hidden note-section" data-category="schedule">
        <h2 class="title is-4">📅 予定</h2>
        <div class="tabs is-toggle is-fullwidth">
          <ul>
            <li class="is-active"><a data-action="write">入力</a></li>
            <li><a data-action="preview">プレビュー</a></li>
          </ul>
        </div>
        <div class="editor-pane">
          <textarea class="markdown-editor textarea" rows="12" placeholder="予定やスケジュールを..."></textarea>
        </div>
        <div class="preview-pane box is-hidden">
          <div class="markdown-rendered"></div>
        </div>
      </section>

      <!-- 設定セクション -->
      <section id="settings" class="section is-hidden">
        <h2 class="title is-4">⚙️ 設定</h2>
        <p>設定項目をここに追加します。</p>
      </section>
    </main>
  </div>

  <!-- marked.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    // サイドバー切り替え
    document.querySelectorAll('.menu-list a').forEach(link => {
      link.addEventListener('click', () => {
        document.querySelectorAll('.menu-list a').forEach(el => el.classList.remove('is-active'));
        link.classList.add('is-active');
        const tgt = link.dataset.target;
        document.querySelectorAll('main .section').forEach(sec => sec.classList.add('is-hidden'));
        document.getElementById(tgt).classList.remove('is-hidden');
        localStorage.setItem('lifeDashboardSection', tgt);
      });
    });

    // ノート系（共通ロジック）
    document.querySelectorAll('.note-section').forEach(sec => {
      const category = sec.dataset.category;
      const tabs = sec.querySelectorAll('.tabs ul li');
      const writeTab = tabs[0], previewTab = tabs[1];
      const editorPane = sec.querySelector('.editor-pane');
      const previewPane = sec.querySelector('.preview-pane');
      const editor = sec.querySelector('.markdown-editor');
      const rendered = sec.querySelector('.markdown-rendered');

      // タブクリック
      writeTab.addEventListener('click', () => {
        writeTab.classList.add('is-active');
        previewTab.classList.remove('is-active');
        editorPane.classList.remove('is-hidden');
        previewPane.classList.add('is-hidden');
      });
      previewTab.addEventListener('click', () => {
        previewTab.classList.add('is-active');
        writeTab.classList.remove('is-active');
        editorPane.classList.add('is-hidden');
        previewPane.classList.remove('is-hidden');
        rendered.innerHTML = marked.parse(editor.value);
      });

      // 自動保存＆プレビュー同期
      editor.addEventListener('input', () => {
        localStorage.setItem(`lifeDashboardNote-${category}`, editor.value);
        if (!previewPane.classList.contains('is-hidden')) {
          rendered.innerHTML = marked.parse(editor.value);
        }
      });

      // 初期ロード時の復元
      const saved = localStorage.getItem(`lifeDashboardNote-${category}`);
      if (saved) editor.value = saved;
    });

    // 起動時に最後のセクションを復元
    window.addEventListener('DOMContentLoaded', () => {
      const last = localStorage.getItem('lifeDashboardSection');
      if (last) {
        const link = document.querySelector(`.menu-list a[data-target="${last}"]`);
        if (link) link.click();
      }
    });
  </script>
</body>
</html>
