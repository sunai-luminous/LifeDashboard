import SwiftUI

// MARK: - モデル定義

/// 記録のカテゴリ
enum Category: String, CaseIterable, Identifiable {
    case diary    = "日記"
    case study    = "勉強"
    case work     = "仕事"
    case schedule = "予定"
    
    var id: String { rawValue }
}

/// データ保存先
enum SaveDestination: String, CaseIterable, Identifiable {
    case local   = "ローカル"
    case iCloud  = "iCloud"
    case dropbox = "Dropbox"
    
    var id: String { rawValue }
}

// MARK: - ViewModel

final class LifeDashboardViewModel: ObservableObject {
    @Published var selectedCategory: Category    = .diary
    @Published var saveDestination: SaveDestination = .local
    @Published var entryText: String             = ""
    
    /// 保存アクション（例）
    func saveEntry() {
        switch saveDestination {
        case .local:
            saveLocally()
        case .iCloud:
            saveToICloud()
        case .dropbox:
            saveToDropbox()
        }
    }
    
    private func saveLocally() {
        // Core Data / Realm などローカル保存ロジック
        print("ローカル保存: [\(selectedCategory.rawValue)] \(entryText)")
    }
    
    private func saveToICloud() {
        // CloudKit 連携ロジック
        print("iCloud保存: [\(selectedCategory.rawValue)] \(entryText)")
    }
    
    private func saveToDropbox() {
        // Dropbox API 連携ロジック
        print("Dropbox保存: [\(selectedCategory.rawValue)] \(entryText)")
    }
}

// MARK: - View

struct LifeDashboardView: View {
    @StateObject private var vm = LifeDashboardViewModel()
    
    var body: some View {
        VStack(spacing: 16) {
            
            // 1. カテゴリ選択セグメント
            Picker(selection: $vm.selectedCategory, label: Text("カテゴリ")) {
                ForEach(Category.allCases) { category in
                    Text(category.rawValue).tag(category)
                }
            }
            .pickerStyle(SegmentedPickerStyle())
            
            // 2. 保存方法選択セグメント
            Picker(selection: $vm.saveDestination, label: Text("保存先")) {
                ForEach(SaveDestination.allCases) { dest in
                    Text(dest.rawValue).tag(dest)
                }
            }
            .pickerStyle(SegmentedPickerStyle())
            
            // 3. 書き込みエリア
            VStack(alignment: .leading, spacing: 8) {
                Text(vm.selectedCategory.rawValue)
                    .font(.headline)
                
                TextEditor(text: $vm.entryText)
                    .padding(8)
                    .frame(maxHeight: .infinity)
                    .background(Color(UIColor.secondarySystemBackground))
                    .cornerRadius(8)
            }
            
            // 任意: 保存ボタン
            Button(action: vm.saveEntry) {
                Text("保存")
                    .frame(maxWidth: .infinity)
                    .padding()
                    .background(Color.accentColor)
                    .foregroundColor(.white)
                    .cornerRadius(8)
            }
            
        }
        .padding()
    }
}

// MARK: - Preview

struct LifeDashboardView_Previews: PreviewProvider {
    static var previews: some View {
        Group {
            LifeDashboardView()
                .preferredColorScheme(.light)
            LifeDashboardView()
                .preferredColorScheme(.dark)
        }
    }
}
