<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>LifeDashboard v5.0</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root {
      /* „É©„Ç§„Éà„É¢„Éº„Éâ */
      --bg-primary: #f5f7fa;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f7fafc;
      --text-primary: #2d3748;
      --text-secondary: #718096;
      --text-muted: #a0aec0;
      --border-color: #e2e8f0;
      --border-hover: #4299e1;
      --shadow: rgba(0,0,0,0.1);
      --shadow-hover: rgba(0,0,0,0.15);
      
      /* „Ç¢„ÇØ„Çª„É≥„Éà„Ç´„É©„Éº */
      --accent-blue: #4299e1;
      --accent-green: #48bb78;
      --accent-orange: #ed8936;
      --accent-purple: #9f7aea;
      --accent-red: #f56565;
      
      /* „Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥ */
      --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-success: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
      --gradient-warning: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
    }
    
    [data-theme="dark"] {
      /* „ÉÄ„Éº„ÇØ„É¢„Éº„Éâ */
      --bg-primary: #1a202c;
      --bg-secondary: #2d3748;
      --bg-tertiary: #4a5568;
      --text-primary: #e2e8f0;
      --text-secondary: #cbd5e0;
      --text-muted: #a0aec0;
      --border-color: #4a5568;
      --border-hover: #63b3ed;
      --shadow: rgba(0,0,0,0.3);
      --shadow-hover: rgba(0,0,0,0.4);
      
      /* „ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÁî®„Ç¢„ÇØ„Çª„É≥„ÉàË™øÊï¥ */
      --accent-blue: #63b3ed;
      --accent-green: #68d391;
      --accent-orange: #f6ad55;
      --accent-purple: #b794f6;
      --accent-red: #fc8181;
    }

    * { box-sizing: border-box; }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
      margin: 0; padding: 0; 
      background: var(--bg-primary);
      color: var(--text-primary);
      transition: all 0.3s ease;
    }
    
    .container { max-width: 1000px; margin: 20px auto; padding: 0 20px; }
    
    .header { 
      text-align: center; margin-bottom: 30px;
      background: var(--bg-secondary);
      padding: 30px; border-radius: 12px;
      box-shadow: 0 2px 15px var(--shadow);
    }
    .header h1 { color: var(--text-primary); font-size: 2.5em; margin-bottom: 10px; }
    .header p { color: var(--text-secondary); font-size: 1.1em; margin: 5px 0; }
    .version-badge {
      display: inline-block; background: var(--gradient-primary);
      color: white; padding: 4px 12px; border-radius: 20px;
      font-size: 0.8em; font-weight: 600; margin-left: 10px;
    }
    
    .controls-panel {
      background: var(--bg-secondary); padding: 25px; border-radius: 12px;
      box-shadow: 0 2px 15px var(--shadow); margin-bottom: 25px;
    }
    
    .controls {
      display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;
    }
    .controls input {
      flex: 1; padding: 12px; font-size: 14px; min-width: 200px;
      border: 2px solid var(--border-color); border-radius: 8px; 
      transition: all 0.3s; background: var(--bg-secondary); color: var(--text-primary);
    }
    .controls input:focus { 
      outline: none; border-color: var(--border-hover); 
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1); 
    }
    
    .theme-toggle {
      background: var(--bg-tertiary); border: 2px solid var(--border-color);
      color: var(--text-primary); padding: 12px 20px; border-radius: 8px;
      cursor: pointer; transition: all 0.3s; font-weight: 600; 
      display: flex; align-items: center; gap: 8px;
    }
    .theme-toggle:hover { border-color: var(--border-hover); transform: translateY(-1px); }
    
    .data-management {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;
    }
    
    .data-btn {
      padding: 12px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; 
      transition: all 0.3s; color: white; text-transform: uppercase; letter-spacing: 0.5px;
      display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .export-all-btn { background: var(--gradient-primary); }
    .import-btn { background: var(--gradient-success); }
    .backup-btn { background: var(--gradient-warning); }
    .clear-btn { background: var(--accent-red); }
    
    .data-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px var(--shadow-hover); }
    
    section { 
      background: var(--bg-secondary); border: none; margin-bottom: 25px;
      padding: 25px; border-radius: 12px; box-shadow: 0 2px 15px var(--shadow); transition: all 0.3s;
    }
    
    section h2 { 
      margin-top: 0; color: var(--text-primary); font-size: 1.5em; margin-bottom: 20px;
      display: flex; align-items: center; gap: 10px;
    }
    
    .section-icon {
      width: 32px; height: 32px; border-radius: 8px;
      display: flex; align-items: center; justify-content: center; 
      color: white; font-weight: bold; font-size: 18px;
    }
    .diary-icon { background: var(--accent-blue); }
    .study-icon { background: var(--accent-green); }
    .work-icon { background: var(--accent-orange); }
    .schedule-icon { background: var(--accent-purple); }
    
    textarea, input[type="text"].editor { 
      width: 100%; min-height: 100px; margin-bottom: 15px; padding: 15px; font-size: 14px;
      border: 2px solid var(--border-color); border-radius: 8px; resize: vertical;
      font-family: inherit; transition: all 0.3s; background: var(--bg-secondary); color: var(--text-primary);
    }
    input[type="text"].editor { min-height: 50px; resize: none; }
    
    textarea:focus, input[type="text"].editor:focus { 
      outline: none; border-color: var(--border-hover); 
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1); 
    }
    
    .tag-input {
      width: 100%; padding: 12px; font-size: 13px; margin-bottom: 15px;
      border: 2px solid var(--border-color); border-radius: 8px; transition: all 0.3s; 
      background: var(--bg-secondary); color: var(--text-primary);
    }
    .tag-input:focus { 
      outline: none; border-color: var(--border-hover); 
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1); 
    }
    
    .btn-group { display: flex; gap: 10px; margin-bottom: 25px; flex-wrap: wrap; }
    .btn-group button {
      padding: 12px 20px; font-size: 14px; cursor: pointer; border: none;
      border-radius: 8px; font-weight: 600; transition: all 0.3s;
      color: white; display: flex; align-items: center; gap: 8px;
    }
    .save-btn { background: var(--accent-blue); }
    .export-section-btn { background: var(--accent-green); }
    
    .btn-group button:hover { transform: translateY(-1px); box-shadow: 0 4px 12px var(--shadow-hover); }
    
    .history { list-style: none; padding: 0; margin: 0; }
    .history li { 
      background: var(--bg-tertiary); border: 1px solid var(--border-color); 
      margin-bottom: 15px; padding: 20px; border-radius: 10px; 
      position: relative; transition: all 0.3s;
    }
    .history li:hover { box-shadow: 0 4px 12px var(--shadow); transform: translateY(-2px); }
    
    .entry-header {
      display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;
    }
    .timestamp { 
      font-size: 12px; color: var(--text-secondary); font-weight: 600;
      background: var(--bg-secondary); padding: 6px 10px; border-radius: 6px;
      border: 1px solid var(--border-color);
    }
    .entry-actions { display: flex; gap: 8px; }
    .delete-btn {
      background: var(--accent-red); color: white; border: none; padding: 6px 10px; 
      border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600; transition: all 0.3s;
    }
    .delete-btn:hover { transform: scale(1.05); }
    
    .tags-container { margin-bottom: 10px; }
    .badge {
      display: inline-block; background: var(--gradient-primary);
      color: white; padding: 4px 10px; font-size: 11px; border-radius: 20px;
      margin-right: 6px; font-weight: 600; 
    }
    
    .entry-content {
      color: var(--text-primary); font-size: 14px; line-height: 1.6;
      background: var(--bg-secondary); padding: 15px; border-radius: 8px; 
      border: 1px solid var(--border-color); white-space: pre-wrap; font-family: inherit;
    }
    
    .toast {
      position: fixed; bottom: 30px; right: 30px; z-index: 1000;
      background: var(--gradient-primary); color: white; padding: 15px 25px; border-radius: 10px;
      font-weight: 600; box-shadow: 0 4px 20px var(--shadow-hover);
      opacity: 0; transform: translateY(100px); 
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    .toast.show { opacity: 1; transform: translateY(0); }
    
    .empty-state { text-align: center; padding: 40px; color: var(--text-muted); }
    .empty-state svg { width: 64px; height: 64px; margin-bottom: 20px; opacity: 0.5; fill: var(--text-muted); }
    
    .auto-save-indicator {
      display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; 
      background: var(--accent-green); color: white; border-radius: 20px; font-size: 12px;
      font-weight: 600; opacity: 0; transition: all 0.3s;
    }
    .auto-save-indicator.show { opacity: 1; }
    
    @media (max-width: 768px) {
      .container { padding: 0 15px; }
      .btn-group, .data-management { flex-direction: column; }
      .btn-group button, .data-btn { width: 100%; }
      .controls { flex-direction: column; }
      .controls input { min-width: auto; width: 100%; }
      .data-management { grid-template-columns: 1fr; }
    }

    /* „Ç´„Çπ„Çø„É†„Çπ„ÇØ„É≠„Éº„É´„Éê„Éº */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg-tertiary); }
    ::-webkit-scrollbar-thumb { background: var(--text-muted); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--text-secondary); }
  </style>
</head>
<body data-theme="light">
  <div class="container">
    <div class="header">
      <h1>üìã LifeDashboard <span class="version-badge">v2.0</span></h1>
      <p>Â†ÖÁâ¢„Å™„Éá„Éº„Çø‰øùÂ≠ò„Å®„ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÂØæÂøú</p>
      <p style="font-size: 0.9em; color: var(--text-muted);">
        üìÖ <span id="current-date"></span>
      </p>
      <div class="auto-save-indicator" id="auto-save">üíæ Ëá™Âãï‰øùÂ≠òÂÆå‰∫Ü</div>
    </div>

    <!-- „Ç≥„É≥„Éà„É≠„Éº„É´„Éë„Éç„É´ -->
    <div class="controls-panel">
      <div class="controls">
        <input id="search-input" placeholder="üîç „Ç≠„Éº„ÉØ„Éº„Éâ„ÅßÊ§úÁ¥¢">
        <input id="tag-filter-input" placeholder="üè∑Ô∏è „Çø„Ç∞„ÅßÁµû„ÇäËæº„Åø">
        <button class="theme-toggle" id="theme-toggle">
          <span id="theme-icon">üåô</span>
          <span id="theme-text">„ÉÄ„Éº„ÇØ</span>
        </button>
      </div>
      
      <div class="data-management">
        <button class="data-btn export-all-btn" id="export-all">üì§ ÂÖ®„Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà</button>
        <button class="data-btn import-btn" id="import-data">üì• „Éá„Éº„Çø„Ç§„É≥„Éù„Éº„Éà</button>
        <button class="data-btn backup-btn" id="create-backup">üíæ „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó‰ΩúÊàê</button>
        <button class="data-btn clear-btn" id="clear-all">üóëÔ∏è ÂÖ®„Éá„Éº„Çø„ÇØ„É™„Ç¢</button>
      </div>
      
      <input type="file" id="file-input" accept=".json,.md,.txt" style="display: none;">
    </div>

    <!-- „Çª„ÇØ„Ç∑„Éß„É≥Ëá™ÂãïÁîüÊàê -->
    <div id="sections-container"></div>
  </div>

  
  <script>
 // LifeDashboard v2.0 JavaScript
class LifeDashboard {
  constructor() {
    this.data = this.loadData();
    this.sections = [
      { id: 'diary', name: 'Êó•Ë®ò', icon: 'üìñ', class: 'diary-icon' },
      { id: 'study', name: 'ÂãâÂº∑', icon: 'üìö', class: 'study-icon' },
      { id: 'work', name: '‰ªï‰∫ã', icon: 'üíº', class: 'work-icon' },
      { id: 'schedule', name: '„Çπ„Ç±„Ç∏„É•„Éº„É´', icon: 'üìÖ', class: 'schedule-icon' }
    ];
    this.currentTheme = localStorage.getItem('lifedashboard-theme') || 'light';
    this.autoSaveTimeout = null;
    
    this.init();
  }

  init() {
    this.setTheme(this.currentTheme);
    this.updateCurrentDate();
    this.createSections();
    this.bindEvents();
    this.loadSectionData();
    this.showToast('LifeDashboard v2.0 Ê∫ñÂÇôÂÆå‰∫ÜÔºÅ', 'success');
  }

  // „Éá„Éº„ÇøÁÆ°ÁêÜ
  loadData() {
    try {
      const saved = localStorage.getItem('lifedashboard-data');
      return saved ? JSON.parse(saved) : {};
    } catch (error) {
      console.error('„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:', error);
      return {};
    }
  }

  saveData(showIndicator = true) {
    try {
      localStorage.setItem('lifedashboard-data', JSON.stringify(this.data));
      if (showIndicator) {
        this.showAutoSaveIndicator();
      }
    } catch (error) {
      console.error('„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó:', error);
      this.showToast('„Éá„Éº„Çø‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
    }
  }

  // „ÉÜ„Éº„ÉûÁÆ°ÁêÜ
  setTheme(theme) {
    document.body.setAttribute('data-theme', theme);
    this.currentTheme = theme;
    localStorage.setItem('lifedashboard-theme', theme);
    
    const themeIcon = document.getElementById('theme-icon');
    const themeText = document.getElementById('theme-text');
    
    if (theme === 'dark') {
      themeIcon.textContent = '‚òÄÔ∏è';
      themeText.textContent = '„É©„Ç§„Éà';
    } else {
      themeIcon.textContent = 'üåô';
      themeText.textContent = '„ÉÄ„Éº„ÇØ';
    }
  }

  toggleTheme() {
    const newTheme = this.currentTheme === 'light' ? 'dark' : 'light';
    this.setTheme(newTheme);
    this.showToast(`${newTheme === 'dark' ? '„ÉÄ„Éº„ÇØ' : '„É©„Ç§„Éà'}„É¢„Éº„Éâ„Å´Âàá„ÇäÊõø„Åà„Åæ„Åó„Åü`, 'info');
  }

  // ÁèæÂú®„ÅÆÊó•‰ªòË°®Á§∫
  updateCurrentDate() {
    const now = new Date();
    const dateStr = now.toLocaleDateString('ja-JP', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      weekday: 'long'
    });
    document.getElementById('current-date').textContent = dateStr;
  }

  // „Çª„ÇØ„Ç∑„Éß„É≥‰ΩúÊàê
  createSections() {
    const container = document.getElementById('sections-container');
    container.innerHTML = '';

    this.sections.forEach(section => {
      const sectionElement = this.createSectionElement(section);
      container.appendChild(sectionElement);
    });
  }

  createSectionElement(section) {
    const sectionDiv = document.createElement('section');
    sectionDiv.id = `section-${section.id}`;
    
    sectionDiv.innerHTML = `
      <h2>
        <div class="section-icon ${section.class}">${section.icon}</div>
        ${section.name}
      </h2>
      
      <textarea 
        id="${section.id}-input" 
        placeholder="${section.name}„ÅÆÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ..."
        rows="4"
      ></textarea>
      
      <input 
        type="text" 
        class="tag-input" 
        id="${section.id}-tags" 
        placeholder="„Çø„Ç∞„Çí„Ç´„É≥„ÉûÂå∫Âàá„Çä„ÅßÂÖ•Âäõ (‰æã: ÈáçË¶Å, ‰ΩúÊ•≠‰∏≠, ÂÆå‰∫Ü)"
      >
      
      <div class="btn-group">
        <button class="save-btn" onclick="dashboard.saveEntry('${section.id}')">
          üíæ ‰øùÂ≠ò
        </button>
        <button class="export-section-btn" onclick="dashboard.exportSection('${section.id}')">
          üì§ „Ç®„ÇØ„Çπ„Éù„Éº„Éà
        </button>
      </div>
      
      <div class="history" id="${section.id}-history"></div>
    `;

    return sectionDiv;
  }

  // „Ç®„É≥„Éà„É™„Éº‰øùÂ≠ò
  saveEntry(sectionId) {
    const input = document.getElementById(`${sectionId}-input`);
    const tagsInput = document.getElementById(`${sectionId}-tags`);
    
    const content = input.value.trim();
    const tags = tagsInput.value.split(',').map(tag => tag.trim()).filter(tag => tag);

    if (!content) {
      this.showToast('ÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'warning');
      return;
    }

    const entry = {
      id: Date.now(),
      content: content,
      tags: tags,
      timestamp: new Date().toISOString(),
      section: sectionId
    };

    if (!this.data[sectionId]) {
      this.data[sectionId] = [];
    }

    this.data[sectionId].unshift(entry);
    this.saveData();
    this.renderHistory(sectionId);
    
    // „Éï„Ç©„Éº„É†„ÇØ„É™„Ç¢
    input.value = '';
    tagsInput.value = '';
    
    this.showToast('„Ç®„É≥„Éà„É™„Éº„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ', 'success');
  }

  // Â±•Ê≠¥Ë°®Á§∫
  renderHistory(sectionId) {
    const historyContainer = document.getElementById(`${sectionId}-history`);
    const entries = this.data[sectionId] || [];
    
    if (entries.length === 0) {
      historyContainer.innerHTML = `
        <div class="empty-state">
          <svg viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
          <p>„Åæ„Å†„Ç®„É≥„Éà„É™„Éº„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
        </div>
      `;
      return;
    }

    historyContainer.innerHTML = entries.map(entry => this.createEntryHTML(entry, sectionId)).join('');
  }

  createEntryHTML(entry, sectionId) {
    const date = new Date(entry.timestamp);
    const dateStr = date.toLocaleDateString('ja-JP') + ' ' + date.toLocaleTimeString('ja-JP');
    
    const tagsHTML = entry.tags.map(tag => `<span class="badge">${tag}</span>`).join('');
    
    return `
      <li>
        <div class="entry-header">
          <div class="timestamp">${dateStr}</div>
          <div class="entry-actions">
            <button class="delete-btn" onclick="dashboard.deleteEntry('${sectionId}', ${entry.id})">
              üóëÔ∏è ÂâäÈô§
            </button>
          </div>
        </div>
        ${entry.tags.length > 0 ? `<div class="tags-container">${tagsHTML}</div>` : ''}
        <div class="entry-content">${entry.content}</div>
      </li>
    `;
  }

  // „Ç®„É≥„Éà„É™„ÉºÂâäÈô§
  deleteEntry(sectionId, entryId) {
    if (!confirm('„Åì„ÅÆ„Ç®„É≥„Éà„É™„Éº„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;
    
    this.data[sectionId] = this.data[sectionId].filter(entry => entry.id !== entryId);
    this.saveData();
    this.renderHistory(sectionId);
    this.showToast('„Ç®„É≥„Éà„É™„Éº„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü', 'info');
  }

  // Ê§úÁ¥¢„Éª„Éï„Ç£„É´„Çø„Éº
  performSearch() {
    const searchTerm = document.getElementById('search-input').value.toLowerCase();
    const tagFilter = document.getElementById('tag-filter-input').value.toLowerCase();
    
    this.sections.forEach(section => {
      const entries = this.data[section.id] || [];
      const filtered = entries.filter(entry => {
        const contentMatch = entry.content.toLowerCase().includes(searchTerm);
        const tagMatch = tagFilter === '' || entry.tags.some(tag => 
          tag.toLowerCase().includes(tagFilter)
        );
        return contentMatch && tagMatch;
      });
      
      this.renderFilteredHistory(section.id, filtered);
    });
  }

  renderFilteredHistory(sectionId, entries) {
    const historyContainer = document.getElementById(`${sectionId}-history`);
    
    if (entries.length === 0) {
      historyContainer.innerHTML = `
        <div class="empty-state">
          <svg viewBox="0 0 24 24">
            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
          </svg>
          <p>Ê§úÁ¥¢Êù°‰ª∂„Å´‰∏ÄËá¥„Åô„Çã„Ç®„É≥„Éà„É™„Éº„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
        </div>
      `;
      return;
    }

    historyContainer.innerHTML = entries.map(entry => this.createEntryHTML(entry, sectionId)).join('');
  }

  // „Éá„Éº„ÇøÁÆ°ÁêÜÊ©üËÉΩ
  exportAllData() {
    const exportData = {
      version: '2.0',
      timestamp: new Date().toISOString(),
      theme: this.currentTheme,
      data: this.data
    };
    
    const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `lifedashboard-backup-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    this.showToast('„Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åó„ÅüÔºÅ', 'success');
  }

  exportSection(sectionId) {
    const sectionData = this.data[sectionId] || [];
    const sectionName = this.sections.find(s => s.id === sectionId)?.name || sectionId;
    
    const exportData = {
      section: sectionName,
      timestamp: new Date().toISOString(),
      entries: sectionData
    };
    
    const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${sectionId}-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    this.showToast(`${sectionName}„Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åó„ÅüÔºÅ`, 'success');
  }

  importData() {
    document.getElementById('file-input').click();
  }

  handleFileImport(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const importedData = JSON.parse(e.target.result);
        
        if (importedData.version && importedData.data) {
          // ÂÆåÂÖ®„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Éï„Ç°„Ç§„É´
          if (confirm('Êó¢Â≠ò„ÅÆ„Éá„Éº„Çø„Çí‰∏äÊõ∏„Åç„Åó„Åæ„Åô„ÅãÔºü')) {
            this.data = importedData.data;
            if (importedData.theme) {
              this.setTheme(importedData.theme);
            }
          }
        } else if (importedData.section && importedData.entries) {
          // „Çª„ÇØ„Ç∑„Éß„É≥Âçò‰Ωì„Éï„Ç°„Ç§„É´
          const sectionId = this.sections.find(s => s.name === importedData.section)?.id;
          if (sectionId) {
            if (confirm(`${importedData.section}„ÅÆ„Éá„Éº„Çø„Çí„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åô„ÅãÔºü`)) {
              this.data[sectionId] = importedData.entries;
            }
          }
        } else {
          throw new Error('‰∏çÊ≠£„Å™„Éï„Ç°„Ç§„É´ÂΩ¢Âºè„Åß„Åô');
        }
        
        this.saveData();
        this.loadSectionData();
        this.showToast('„Éá„Éº„Çø„Çí„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åó„ÅüÔºÅ', 'success');
        
      } catch (error) {
        console.error('Import error:', error);
        this.showToast('„Ç§„É≥„Éù„Éº„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
      }
    };
    
    reader.readAsText(file);
    event.target.value = '';
  }

  createBackup() {
    const backupData = {
      version: '2.0',
      timestamp: new Date().toISOString(),
      theme: this.currentTheme,
      data: this.data,
      metadata: {
        totalEntries: Object.values(this.data).reduce((sum, entries) => sum + entries.length, 0),
        sections: Object.keys(this.data)
      }
    };
    
    const backupKey = `lifedashboard-backup-${Date.now()}`;
    localStorage.setItem(backupKey, JSON.stringify(backupData));
    
    this.showToast('„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Çí‰ΩúÊàê„Åó„Åæ„Åó„ÅüÔºÅ', 'success');
  }

  clearAllData() {
    if (!confirm('ÂÖ®„Å¶„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ')) return;
    if (!confirm('Êú¨ÂΩì„Å´„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü')) return;
    
    this.data = {};
    this.saveData(false);
    this.loadSectionData();
    this.showToast('ÂÖ®„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü', 'info');
  }

  // „Çª„ÇØ„Ç∑„Éß„É≥„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø
  loadSectionData() {
    this.sections.forEach(section => {
      this.renderHistory(section.id);
    });
  }

  // Ëá™Âãï‰øùÂ≠ò„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº
  showAutoSaveIndicator() {
    const indicator = document.getElementById('auto-save');
    indicator.classList.add('show');
    setTimeout(() => {
      indicator.classList.remove('show');
    }, 2000);
  }

  // „Éà„Éº„Çπ„ÉàÈÄöÁü•
  showToast(message, type = 'info') {
    const existingToast = document.querySelector('.toast');
    if (existingToast) {
      existingToast.remove();
    }

    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = message;
    
    // „Çø„Ç§„Éó„Å´Âøú„Åò„Å¶„Çπ„Çø„Ç§„É´Â§âÊõ¥
    if (type === 'success') {
      toast.style.background = 'var(--gradient-success)';
    } else if (type === 'warning') {
      toast.style.background = 'var(--gradient-warning)';
    } else if (type === 'error') {
      toast.style.background = 'var(--accent-red)';
    }
    
    document.body.appendChild(toast);
    
    // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
    setTimeout(() => toast.classList.add('show'), 100);
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => toast.remove(), 400);
    }, 3000);
  }

  // „Ç§„Éô„É≥„Éà„Éê„Ç§„É≥„Éá„Ç£„É≥„Ç∞
  bindEvents() {
    // „ÉÜ„Éº„ÉûÂàá„ÇäÊõø„Åà
    document.getElementById('theme-toggle').addEventListener('click', () => {
      this.toggleTheme();
    });

    // Ê§úÁ¥¢„Éª„Éï„Ç£„É´„Çø„Éº
    document.getElementById('search-input').addEventListener('input', () => {
      clearTimeout(this.searchTimeout);
      this.searchTimeout = setTimeout(() => this.performSearch(), 300);
    });

    document.getElementById('tag-filter-input').addEventListener('input', () => {
      clearTimeout(this.filterTimeout);
      this.filterTimeout = setTimeout(() => this.performSearch(), 300);
    });

    // „Éá„Éº„ÇøÁÆ°ÁêÜ„Éú„Çø„É≥
    document.getElementById('export-all').addEventListener('click', () => {
      this.exportAllData();
    });

    document.getElementById('import-data').addEventListener('click', () => {
      this.importData();
    });

    document.getElementById('create-backup').addEventListener('click', () => {
      this.createBackup();
    });

    document.getElementById('clear-all').addEventListener('click', () => {
      this.clearAllData();
    });

    // „Éï„Ç°„Ç§„É´„Ç§„É≥„Éù„Éº„Éà
    document.getElementById('file-input').addEventListener('change', (e) => {
      this.handleFileImport(e);
    });

    // Ëá™Âãï‰øùÂ≠òÔºàÂÖ•ÂäõÊôÇÔºâ
    document.addEventListener('input', (e) => {
      if (e.target.matches('textarea, .tag-input')) {
        clearTimeout(this.autoSaveTimeout);
        this.autoSaveTimeout = setTimeout(() => {
          // ‰∏ÄÊôÇ‰øùÂ≠òÔºà‰∏ãÊõ∏„ÅçÔºâÊ©üËÉΩ
          const sectionId = e.target.id.replace('-input', '').replace('-tags', '');
          const draftKey = `draft-${sectionId}`;
          const draftData = {
            content: document.getElementById(`${sectionId}-input`)?.value || '',
            tags: document.getElementById(`${sectionId}-tags`)?.value || '',
            timestamp: Date.now()
          };
          localStorage.setItem(draftKey, JSON.stringify(draftData));
        }, 1000);
      }
    });

    // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆ‰∏ãÊõ∏„ÅçÂæ©ÂÖÉ
    window.addEventListener('beforeunload', () => {
      this.sections.forEach(section => {
        const content = document.getElementById(`${section.id}-input`)?.value;
        const tags = document.getElementById(`${section.id}-tags`)?.value;
        if (content || tags) {
          const draftKey = `draft-${section.id}`;
          const draftData = { content, tags, timestamp: Date.now() };
          localStorage.setItem(draftKey, JSON.stringify(draftData));
        }
      });
    });
  }

  // ‰∏ãÊõ∏„ÅçÂæ©ÂÖÉ
  restoreDrafts() {
    this.sections.forEach(section => {
      const draftKey = `draft-${section.id}`;
      const draft = localStorage.getItem(draftKey);
      if (draft) {
        try {
          const draftData = JSON.parse(draft);
          const contentInput = document.getElementById(`${section.id}-input`);
          const tagsInput = document.getElementById(`${section.id}-tags`);
          
          if (contentInput && draftData.content) {
            contentInput.value = draftData.content;
          }
          if (tagsInput && draftData.tags) {
            tagsInput.value = draftData.tags;
          }
        } catch (error) {
          console.error('‰∏ãÊõ∏„ÅçÂæ©ÂÖÉ„Ç®„É©„Éº:', error);
        }
      }
    });
  }
}

// ÂàùÊúüÂåñ
let dashboard;
document.addEventListener('DOMContentLoaded', () => {
  dashboard = new LifeDashboard();
  
  // ‰∏ãÊõ∏„ÅçÂæ©ÂÖÉ
  setTimeout(() => {
    dashboard.restoreDrafts();
  }, 100);
});
</script>
</body>
</html>
