<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8"/>
  <title>LifeDashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    :root {
      --bg: #F2F2F2;
      --fg: #2E2E2E;
      --muted: #7A7A7A;
      --border: #CCCCCC;
      --accent: #A0A0A0;
      --accent-red: #B05050;
    }
    [data-theme="dark"] {
      --bg: #2A2A2A;
      --fg: #E0E0E0;
      --muted: #A0A0A0;
      --border: #444444;
      --accent: #777777;
      --accent-red: #A04040;
    }
    *, *::before, *::after {
      transition: background-color .2s, color .2s, border-color .2s;
      box-sizing: border-box;
    }
    body {
      margin: 0; padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--fg);
      line-height: 1.5;
    }
    .container {
      max-width: 800px;
      margin: 20px auto;
      padding: 0 16px;
    }
    .header {
      text-align: center;
      margin-bottom: 24px;
    }
    .header h1 {
      font-size: 2rem;
      margin-bottom: 8px;
    }
    .header p {
      color: var(--muted);
      font-size: .9rem;
    }
    .controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }
    .controls input,
    .controls button {
      flex: 1;
      font-size: 1rem;
      padding: 6px 10px;
      border: 1px solid var(--border);
      border-radius: 2px;
      background: transparent;
      color: var(--fg);
    }
    .controls button:hover {
      background: var(--accent);
      color: var(--bg);
      cursor: pointer;
    }
    .data-management {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 24px;
    }
    .data-management button {
      flex: 1;
      font-size: 1rem;
      padding: 6px 10px;
      border: 1px solid var(--border);
      border-radius: 2px;
      background: transparent;
      color: var(--fg);
    }
    .data-management .btn-delete-all {
      border-color: var(--accent-red);
    }
    .data-management button:hover {
      background: var(--accent);
      color: var(--bg);
      cursor: pointer;
    }
    .btn-save {
      background: var(--accent);
      border-color: var(--accent);
      color: var(--bg);
    }
    .btn-save:hover {
      background: var(--accent-red);
      border-color: var(--accent-red);
      cursor: pointer;
    }
    textarea,
    .tag-input {
      width: 100%;
      font-size: 1rem;
      padding: 8px;
      border: 1px solid var(--border);
      border-radius: 2px;
      background: var(--bg);
      color: var(--fg);
      resize: vertical;
      margin-bottom: 8px;
    }
    button.section-delete {
      background: var(--accent-red);
      border: none;
      color: var(--bg);
      padding: 4px 8px;
      border-radius: 2px;
      font-size: .9rem;
    }
    button.section-delete:hover {
      background: #A03030;
      cursor: pointer;
    }
    section {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 16px;
      margin-bottom: 16px;
    }
    section h2 {
      font-size: 1.2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .section-icon {
      margin-right: 8px;
    }
    ul.history {
      list-style: none;
      margin-top: 12px;
      padding: 0;
    }
    .history li {
      border-top: 1px solid var(--border);
      padding: 8px 0;
    }
    .timestamp {
      font-size: .8rem;
      color: var(--muted);
      margin-bottom: 4px;
    }
    .badge {
      display: inline-block;
      background: var(--accent);
      color: var(--bg);
      padding: 2px 6px;
      font-size: .75rem;
      border-radius: 2px;
      margin-right: 4px;
    }
    .entry-content {
      white-space: pre-wrap;
      margin-top: 4px;
    }
    .toast {
      position: fixed;
      bottom: 20px; right: 20px;
      padding: 8px 16px;
      background: var(--accent);
      color: var(--bg);
      border-radius: 2px;
      opacity: 0;
      transform: translateY(20px);
      pointer-events: none;
    }
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
  </style>
</head>
<body data-theme="light">
  <div class="container">
    <div class="header">
      <h1>📋 LifeDashboard</h1>
      <p>📅 <span id="current-date"></span></p>
    </div>

    <div class="controls">
      <input id="search-input" placeholder="🔍 キーワード">
      <input id="tag-input" placeholder="🏷️ タグ絞込">
      <button id="toggle-theme">🌙 ダーク</button>
    </div>

    <div class="data-management">
      <button id="export-all">💾 エクスポート</button>
      <button id="import-all">📥 インポート</button>
      <button id="delete-all" class="btn-delete-all">🗑️ 全削除</button>
    </div>

    <input type="file" id="file-input" accept=".md" style="display:none">

    <section id="diary">
      <h2>
        <span><span class="section-icon">📖</span>日記</span>
        <button class="section-delete" data-section="diary">削除</button>
      </h2>
      <textarea id="diary-input" rows="3" placeholder="今日の出来事…"></textarea>
      <input class="tag-input" id="diary-tags" placeholder="タグ (例: 重要, 楽しい)">
      <button class="btn-save" data-section="diary">保存</button>
      <ul class="history" id="diary-history"></ul>
    </section>

    <section id="study">
      <h2>
        <span><span class="section-icon">📚</span>勉強</span>
        <button class="section-delete" data-section="study">削除</button>
      </h2>
      <textarea id="study-input" rows="3" placeholder="学んだこと…"></textarea>
      <input class="tag-input" id="study-tags" placeholder="タグ (例: 数学, 英語)">
      <button class="btn-save" data-section="study">保存</button>
      <ul class="history" id="study-history"></ul>
    </section>

    <section id="work">
      <h2>
        <span><span class="section-icon">💼</span>仕事</span>
        <button class="section-delete" data-section="work">削除</button>
      </h2>
      <textarea id="work-input" rows="3" placeholder="仕事の記録…"></textarea>
      <input class="tag-input" id="work-tags" placeholder="タグ (例: 会議, タスク)">
      <button class="btn-save" data-section="work">保存</button>
      <ul class="history" id="work-history"></ul>
    </section>

    <section id="schedule">
      <h2>
        <span><span class="section-icon">📅</span>スケジュール</span>
        <button class="section-delete" data-section="schedule">削除</button>
      </h2>
      <textarea id="schedule-input" rows="3" placeholder="予定…"></textarea>
      <input class="tag-input" id="schedule-tags" placeholder="タグ (例: 締切, イベント)">
      <button class="btn-save" data-section="schedule">保存</button>
      <ul class="history" id="schedule-history"></ul>
    </section>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    document.addEventListener('DOMContentLoaded', init);

    function init() {
      updateDate();
      applyStoredTheme();
      bindEvents();
      loadAllSections();
    }

    function updateDate() {
      const now = new Date();
      document.getElementById('current-date').textContent =
        now.toLocaleDateString('ja-JP',{year:'numeric',month:'long',day:'numeric',weekday:'long'});
    }

    function applyStoredTheme() {
      const theme = localStorage.getItem('theme') || 'light';
      document.body.dataset.theme = theme;
      document.getElementById('toggle-theme').textContent =
        theme === 'light' ? '🌙 ダーク' : '☀️ ライト';
    }

    function toggleTheme() {
      const next = document.body.dataset.theme === 'light' ? 'dark' : 'light';
      document.body.dataset.theme = next;
      localStorage.setItem('theme', next);
      document.getElementById('toggle-theme').textContent =
        next === 'light' ? '🌙 ダーク' : '☀️ ライト';
      showToast('テーマを切り替えました');
    }

    function bindEvents() {
      document.getElementById('toggle-theme').onclick = toggleTheme;
      document.getElementById('export-all').onclick = exportAll;
      document.getElementById('import-all').onclick = () =>
        document.getElementById('file-input').click();
      document.getElementById('delete-all').onclick = deleteAllSections;
      document.getElementById('file-input').onchange = handleImport;

      ['diary','study','work','schedule'].forEach(sec => {
        document.querySelector(`#${sec} .btn-save`).onclick =
          () => saveEntry(sec);
        document.querySelector(`#${sec} .section-delete`).onclick =
          () => deleteSection(sec);
      });
    }

    function saveEntry(section) {
      const txt = document.getElementById(section + '-input').value.trim();
      if (!txt) return showToast('内容を入力してください','error');

      const now = new Date();
      const header = `### ${now.toLocaleDateString('ja-JP',{month:'numeric',day:'numeric',weekday:'short'})} `
                   + `${now.toLocaleTimeString('ja-JP',{hour:'2-digit',minute:'2-digit'})}\n`;
      const tags = document.getElementById(section + '-tags').value
        .split(',').map(t=>t.trim()).filter(Boolean);
      const tagLn = tags.length ? `タグ: ${tags.map(t=>'#'+t).join(' ')}\n` : '';
      const entry = header + tagLn + txt + '\n\n';

      const key = section + '-md';
      localStorage.setItem(key, entry + (localStorage.getItem(key)||''));

      document.getElementById(section + '-input').value = '';
      document.getElementById(section + '-tags').value = '';
      renderHistory(section);
      showToast('保存しました！');
    }

    function deleteSection(section) {
      const names = {diary:'日記',study:'勉強',work:'仕事',schedule:'スケジュール'};
      if (!confirm(`${names[section]}をすべて削除しますか？`)) return;
      localStorage.removeItem(section + '-md');
      renderHistory(section);
      showToast(`${names[section]}を削除しました`);
    }

    function deleteAllSections() {
      if (!confirm('すべてのデータを削除しますか？')) return;
      ['diary','study','work','schedule'].forEach(s =>
        localStorage.removeItem(s+'-md'));
      loadAllSections();
      showToast('すべて削除しました');
    }

    function renderHistory(section) {
      const key = section + '-md';
      const md  = (localStorage.getItem(key)||'').trim();
      const ul  = document.getElementById(section + '-history');
      if (!md) {
        ul.innerHTML = '<li class="timestamp empty">まだ記録がありません</li>';
        return;
      }
      const blocks = md.split('\n### ').map((b,i)=>i? '### '+b : b);
      ul.innerHTML = blocks.map(block => {
        const lines = block.split('\n');
        const ts = lines[0].replace(/^###\s*/,'');
        let idx=1, tags=[];
        if (lines[1]&&lines[1].startsWith('タグ:')) {
          tags = lines[1].replace(/^タグ:\s*/,'').split(' ').map(t=>t.replace('#',''));
          idx=2;
        }
        const content = lines.slice(idx).join('\n');
        const badges = tags.map(t=>`<span class="badge">${t}</span>`).join('');
        return `<li><div class="timestamp">${ts}</div>`
             + (badges? `<div>${badges}</div>`:'')
             + `<div class="entry-content">${escapeHtml(content)}</div></li>`;
      }).join('');
    }

    function loadAllSections() {
      ['diary','study','work','schedule'].forEach(renderHistory);
    }

    function exportAll() {
      const now = new Date();
      let md = `# LifeDashboard ${now.getFullYear()}年${now.toLocaleDateString('ja-JP',{month:'long'})}\n\n`;
      ['diary','study','work','schedule'].forEach(sec => {
        const data = (localStorage.getItem(sec+'-md')||'').trim();
        if (!data) return;
        const title = document.querySelector(`#${sec} h2 span`).innerText;
        md += `## ${title}\n\n` + data;
      });
      const blob = new Blob([md], {type:'text/markdown'});
      const url  = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href     = url;
      a.download = `LifeDashboard-${now.toISOString().split('T')[0]}.md`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showToast('エクスポート完了！');
    }

    function handleImport(e) {
      const f = e.target.files[0];
      if (!f) return;
      const r = new FileReader();
      r.onload = ev => {
        const imp = parseImportedMarkdown(ev.target.result);
        if (confirm('追加：OK 上書き：キャンセル')) {
          Object.keys(imp).forEach(sec => {
            const prev = localStorage.getItem(sec+'-md')||'';
            localStorage.setItem(sec+'-md', imp[sec]+prev);
          });
        } else {
          Object.keys(imp).forEach(sec =>
            localStorage.setItem(sec+'-md', imp[sec]));
        }
        loadAllSections();
        showToast('インポート完了！');
      };
      r.readAsText(f);
      e.target.value = '';
    }

    function parseImportedMarkdown(md) {
      const map = {'日記':'diary','勉強':'study','仕事':'work','スケジュール':'schedule'};
      const out = {diary:'',study:'',work:'',schedule:''};
      let cur=null, buf='';
      md.split('\n').forEach(line => {
        if (line.startsWith('## ')) {
          if (cur && buf) { out[cur]+= buf+'\n'; buf=''; }
          cur = map[line.replace('## ','').trim()]||null;
        } else if (cur) {
          buf += line+'\n';
        }
      });
      if (cur && buf) out[cur] += buf;
      return out;
    }

    function showToast(msg, type='info') {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.style.background = type==='error'? 'var(--accent-red)' : 'var(--accent)';
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 2000);
    }

    function escapeHtml(s) {
      const d = document.createElement('div');
      d.textContent = s;
      return d.innerHTML;
    }
  </script>
</body>
</html>

