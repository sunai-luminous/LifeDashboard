<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>LifeDashboard v5.0</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root {
      /* ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ */
      --bg-primary: #f5f7fa;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f7fafc;
      --text-primary: #2d3748;
      --text-secondary: #718096;
      --text-muted: #a0aec0;
      --border-color: #e2e8f0;
      --border-hover: #4299e1;
      --shadow: rgba(0,0,0,0.1);
      --shadow-hover: rgba(0,0,0,0.15);
      
      /* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ */
      --accent-blue: #4299e1;
      --accent-green: #48bb78;
      --accent-orange: #ed8936;
      --accent-purple: #9f7aea;
      --accent-red: #f56565;
      
      /* ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
      --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-success: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
      --gradient-warning: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
    }
    
    [data-theme="dark"] {
      /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ */
      --bg-primary: #1a202c;
      --bg-secondary: #2d3748;
      --bg-tertiary: #4a5568;
      --text-primary: #e2e8f0;
      --text-secondary: #cbd5e0;
      --text-muted: #a0aec0;
      --border-color: #4a5568;
      --border-hover: #63b3ed;
      --shadow: rgba(0,0,0,0.3);
      --shadow-hover: rgba(0,0,0,0.4);
      
      /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ç”¨ã‚¢ã‚¯ã‚»ãƒ³ãƒˆèª¿æ•´ */
      --accent-blue: #63b3ed;
      --accent-green: #68d391;
      --accent-orange: #f6ad55;
      --accent-purple: #b794f6;
      --accent-red: #fc8181;
    }

    * { box-sizing: border-box; }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
      margin: 0; padding: 0; 
      background: var(--bg-primary);
      color: var(--text-primary);
      transition: all 0.3s ease;
    }
    
    .container { max-width: 1000px; margin: 20px auto; padding: 0 20px; }
    
    .header { 
      text-align: center; margin-bottom: 30px;
      background: var(--bg-secondary);
      padding: 30px; border-radius: 12px;
      box-shadow: 0 2px 15px var(--shadow);
    }
    .header h1 { color: var(--text-primary); font-size: 2.5em; margin-bottom: 10px; }
    .header p { color: var(--text-secondary); font-size: 1.1em; margin: 5px 0; }
    .version-badge {
      display: inline-block; background: var(--gradient-primary);
      color: white; padding: 4px 12px; border-radius: 20px;
      font-size: 0.8em; font-weight: 600; margin-left: 10px;
    }
    
    .controls-panel {
      background: var(--bg-secondary); padding: 25px; border-radius: 12px;
      box-shadow: 0 2px 15px var(--shadow); margin-bottom: 25px;
    }
    
    .controls {
      display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;
    }
    .controls input {
      flex: 1; padding: 12px; font-size: 14px; min-width: 200px;
      border: 2px solid var(--border-color); border-radius: 8px; 
      transition: all 0.3s; background: var(--bg-secondary); color: var(--text-primary);
    }
    .controls input:focus { 
      outline: none; border-color: var(--border-hover); 
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1); 
    }
    
    .theme-toggle {
      background: var(--bg-tertiary); border: 2px solid var(--border-color);
      color: var(--text-primary); padding: 12px 20px; border-radius: 8px;
      cursor: pointer; transition: all 0.3s; font-weight: 600; 
      display: flex; align-items: center; gap: 8px;
    }
    .theme-toggle:hover { border-color: var(--border-hover); transform: translateY(-1px); }
    
    .data-management {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;
    }
    
    .data-btn {
      padding: 12px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; 
      transition: all 0.3s; color: white; text-transform: uppercase; letter-spacing: 0.5px;
      display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .export-all-btn { background: var(--gradient-primary); }
    .import-btn { background: var(--gradient-success); }
    .backup-btn { background: var(--gradient-warning); }
    .clear-btn { background: var(--accent-red); }
    
    .data-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px var(--shadow-hover); }
    
    section { 
      background: var(--bg-secondary); border: none; margin-bottom: 25px;
      padding: 25px; border-radius: 12px; box-shadow: 0 2px 15px var(--shadow); transition: all 0.3s;
    }
    
    section h2 { 
      margin-top: 0; color: var(--text-primary); font-size: 1.5em; margin-bottom: 20px;
      display: flex; align-items: center; gap: 10px;
    }
    
    .section-icon {
      width: 32px; height: 32px; border-radius: 8px;
      display: flex; align-items: center; justify-content: center; 
      color: white; font-weight: bold; font-size: 18px;
    }
    .diary-icon { background: var(--accent-blue); }
    .study-icon { background: var(--accent-green); }
    .work-icon { background: var(--accent-orange); }
    .schedule-icon { background: var(--accent-purple); }
    
    textarea, input[type="text"].editor { 
      width: 100%; min-height: 100px; margin-bottom: 15px; padding: 15px; font-size: 14px;
      border: 2px solid var(--border-color); border-radius: 8px; resize: vertical;
      font-family: inherit; transition: all 0.3s; background: var(--bg-secondary); color: var(--text-primary);
    }
    input[type="text"].editor { min-height: 50px; resize: none; }
    
    textarea:focus, input[type="text"].editor:focus { 
      outline: none; border-color: var(--border-hover); 
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1); 
    }
    
    .tag-input {
      width: 100%; padding: 12px; font-size: 13px; margin-bottom: 15px;
      border: 2px solid var(--border-color); border-radius: 8px; transition: all 0.3s; 
      background: var(--bg-secondary); color: var(--text-primary);
    }
    .tag-input:focus { 
      outline: none; border-color: var(--border-hover); 
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1); 
    }
    
    .btn-group { display: flex; gap: 10px; margin-bottom: 25px; flex-wrap: wrap; }
    .btn-group button {
      padding: 12px 20px; font-size: 14px; cursor: pointer; border: none;
      border-radius: 8px; font-weight: 600; transition: all 0.3s;
      color: white; display: flex; align-items: center; gap: 8px;
    }
    .save-btn { background: var(--accent-blue); }
    .export-section-btn { background: var(--accent-green); }
    
    .btn-group button:hover { transform: translateY(-1px); box-shadow: 0 4px 12px var(--shadow-hover); }
    
    .history { list-style: none; padding: 0; margin: 0; }
    .history li { 
      background: var(--bg-tertiary); border: 1px solid var(--border-color); 
      margin-bottom: 15px; padding: 20px; border-radius: 10px; 
      position: relative; transition: all 0.3s;
    }
    .history li:hover { box-shadow: 0 4px 12px var(--shadow); transform: translateY(-2px); }
    
    .entry-header {
      display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;
    }
    .timestamp { 
      font-size: 12px; color: var(--text-secondary); font-weight: 600;
      background: var(--bg-secondary); padding: 6px 10px; border-radius: 6px;
      border: 1px solid var(--border-color);
    }
    .entry-actions { display: flex; gap: 8px; }
    .delete-btn {
      background: var(--accent-red); color: white; border: none; padding: 6px 10px; 
      border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600; transition: all 0.3s;
    }
    .delete-btn:hover { transform: scale(1.05); }
    
    .tags-container { margin-bottom: 10px; }
    .badge {
      display: inline-block; background: var(--gradient-primary);
      color: white; padding: 4px 10px; font-size: 11px; border-radius: 20px;
      margin-right: 6px; font-weight: 600; 
    }
    
    .entry-content {
      color: var(--text-primary); font-size: 14px; line-height: 1.6;
      background: var(--bg-secondary); padding: 15px; border-radius: 8px; 
      border: 1px solid var(--border-color); white-space: pre-wrap; font-family: inherit;
    }
    
    .toast {
      position: fixed; bottom: 30px; right: 30px; z-index: 1000;
      background: var(--gradient-primary); color: white; padding: 15px 25px; border-radius: 10px;
      font-weight: 600; box-shadow: 0 4px 20px var(--shadow-hover);
      opacity: 0; transform: translateY(100px); 
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    .toast.show { opacity: 1; transform: translateY(0); }
    
    .empty-state { text-align: center; padding: 40px; color: var(--text-muted); }
    .empty-state svg { width: 64px; height: 64px; margin-bottom: 20px; opacity: 0.5; fill: var(--text-muted); }
    
    .auto-save-indicator {
      display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; 
      background: var(--accent-green); color: white; border-radius: 20px; font-size: 12px;
      font-weight: 600; opacity: 0; transition: all 0.3s;
    }
    .auto-save-indicator.show { opacity: 1; }
    
    @media (max-width: 768px) {
      .container { padding: 0 15px; }
      .btn-group, .data-management { flex-direction: column; }
      .btn-group button, .data-btn { width: 100%; }
      .controls { flex-direction: column; }
      .controls input { min-width: auto; width: 100%; }
      .data-management { grid-template-columns: 1fr; }
    }

    /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg-tertiary); }
    ::-webkit-scrollbar-thumb { background: var(--text-muted); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--text-secondary); }
  </style>
</head>
<body data-theme="light">
  <div class="container">
    <div class="header">
      <h1>ğŸ“‹ LifeDashboard <span class="version-badge">v2.0</span></h1>
      <p>å …ç‰¢ãªãƒ‡ãƒ¼ã‚¿ä¿å­˜ã¨ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ</p>
      <p style="font-size: 0.9em; color: var(--text-muted);">
        ğŸ“… <span id="current-date"></span>
      </p>
      <div class="auto-save-indicator" id="auto-save">ğŸ’¾ è‡ªå‹•ä¿å­˜å®Œäº†</div>
    </div>

    <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
    <div class="controls-panel">
      <div class="controls">
        <input id="search-input" placeholder="ğŸ” ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢">
        <input id="tag-filter-input" placeholder="ğŸ·ï¸ ã‚¿ã‚°ã§çµã‚Šè¾¼ã¿">
        <button class="theme-toggle" id="theme-toggle">
          <span id="theme-icon">ğŸŒ™</span>
          <span id="theme-text">ãƒ€ãƒ¼ã‚¯</span>
        </button>
      </div>
      
      <div class="data-management">
        <button class="data-btn export-all-btn" id="export-all">ğŸ“¤ å…¨ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
        <button class="data-btn import-btn" id="import-data">ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
        <button class="data-btn backup-btn" id="create-backup">ğŸ’¾ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ</button>
        <button class="data-btn clear-btn" id="clear-all">ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
      </div>
      
      <input type="file" id="file-input" accept=".json,.md,.txt" style="display: none;">
    </div>

    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³è‡ªå‹•ç”Ÿæˆ -->
    <div id="sections-container"></div>
  </div>

  
  <script>
 // LifeDashboard v2.0 JavaScript
class LifeDashboard {
  constructor() {
    this.data = this.loadData();
    this.sections = [
      { id: 'diary', name: 'æ—¥è¨˜', icon: 'ğŸ“–', class: 'diary-icon' },
      { id: 'study', name: 'å‹‰å¼·', icon: 'ğŸ“š', class: 'study-icon' },
      { id: 'work', name: 'ä»•äº‹', icon: 'ğŸ’¼', class: 'work-icon' },
      { id: 'schedule', name: 'ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«', icon: 'ğŸ“…', class: 'schedule-icon' }
    ];
    this.currentTheme = localStorage.getItem('lifedashboard-theme') || 'light';
    this.autoSaveTimeout = null;
    
    this.init();
  }

  init() {
    this.setTheme(this.currentTheme);
    this.updateCurrentDate();
    this.createSections();
    this.bindEvents();
    this.loadSectionData();
    this.showToast('LifeDashboard v2.0 æº–å‚™å®Œäº†ï¼', 'success');
  }

  // ãƒ‡ãƒ¼ã‚¿ç®¡ç†
  loadData() {
    try {
      const saved = localStorage.getItem('lifedashboard-data');
      return saved ? JSON.parse(saved) : {};
    } catch (error) {
      console.error('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:', error);
      return {};
    }
  }

  saveData(showIndicator = true) {
    try {
      localStorage.setItem('lifedashboard-data', JSON.stringify(this.data));
      if (showIndicator) {
        this.showAutoSaveIndicator();
      }
    } catch (error) {
      console.error('ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—:', error);
      this.showToast('ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
    }
  }

  // ãƒ†ãƒ¼ãƒç®¡ç†
  setTheme(theme) {
    document.body.setAttribute('data-theme', theme);
    this.currentTheme = theme;
    localStorage.setItem('lifedashboard-theme', theme);
    
    const themeIcon = document.getElementById('theme-icon');
    const themeText = document.getElementById('theme-text');
    
    if (theme === 'dark') {
      themeIcon.textContent = 'â˜€ï¸';
      themeText.textContent = 'ãƒ©ã‚¤ãƒˆ';
    } else {
      themeIcon.textContent = 'ğŸŒ™';
      themeText.textContent = 'ãƒ€ãƒ¼ã‚¯';
    }
  }

  toggleTheme() {
    const newTheme = this.currentTheme === 'light' ? 'dark' : 'light';
    this.setTheme(newTheme);
    this.showToast(`${newTheme === 'dark' ? 'ãƒ€ãƒ¼ã‚¯' : 'ãƒ©ã‚¤ãƒˆ'}ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ`, 'info');
  }

  // ç¾åœ¨ã®æ—¥ä»˜è¡¨ç¤º
  updateCurrentDate() {
    const now = new Date();
    const dateStr = now.toLocaleDateString('ja-JP', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      weekday: 'long'
    });
    document.getElementById('current-date').textContent = dateStr;
  }

  // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä½œæˆ
  createSections() {
    const container = document.getElementById('sections-container');
    container.innerHTML = '';

    this.sections.forEach(section => {
      const sectionElement = this.createSectionElement(section);
      container.appendChild(sectionElement);
    });
  }

  createSectionElement(section) {
    const sectionDiv = document.createElement('section');
    sectionDiv.id = `section-${section.id}`;
    
    sectionDiv.innerHTML = `
      <h2>
        <div class="section-icon ${section.class}">${section.icon}</div>
        ${section.name}
      </h2>
      
      <textarea 
        id="${section.id}-input" 
        placeholder="${section.name}ã®å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."
        rows="4"
      ></textarea>
      
      <input 
        type="text" 
        class="tag-input" 
        id="${section.id}-tags" 
        placeholder="ã‚¿ã‚°ã‚’ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§å…¥åŠ› (ä¾‹: é‡è¦, ä½œæ¥­ä¸­, å®Œäº†)"
      >
      
      <div class="btn-group">
        <button class="save-btn" onclick="dashboard.saveEntry('${section.id}')">
          ğŸ’¾ ä¿å­˜
        </button>
        <button class="export-section-btn" onclick="dashboard.exportSection('${section.id}')">
          ğŸ“¤ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        </button>
      </div>
      
      <div class="history" id="${section.id}-history"></div>
    `;

    return sectionDiv;
  }

  // ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä¿å­˜
  saveEntry(sectionId) {
    const input = document.getElementById(`${sectionId}-input`);
    const tagsInput = document.getElementById(`${sectionId}-tags`);
    
    const content = input.value.trim();
    const tags = tagsInput.value.split(',').map(tag => tag.trim()).filter(tag => tag);

    if (!content) {
      this.showToast('å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'warning');
      return;
    }

    const entry = {
      id: Date.now(),
      content: content,
      tags: tags,
      timestamp: new Date().toISOString(),
      section: sectionId
    };

    if (!this.data[sectionId]) {
      this.data[sectionId] = [];
    }

    this.data[sectionId].unshift(entry);
    this.saveData();
    this.renderHistory(sectionId);
    
    // ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢
    input.value = '';
    tagsInput.value = '';
    
    this.showToast('ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼', 'success');
  }

  // å±¥æ­´è¡¨ç¤º
  renderHistory(sectionId) {
    const historyContainer = document.getElementById(`${sectionId}-history`);
    const entries = this.data[sectionId] || [];
    
    if (entries.length === 0) {
      historyContainer.innerHTML = `
        <div class="empty-state">
          <svg viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
          <p>ã¾ã ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“</p>
        </div>
      `;
      return;
    }

    historyContainer.innerHTML = entries.map(entry => this.createEntryHTML(entry, sectionId)).join('');
  }

  createEntryHTML(entry, sectionId) {
    const date = new Date(entry.timestamp);
    const dateStr = date.toLocaleDateString('ja-JP') + ' ' + date.toLocaleTimeString('ja-JP');
    
    const tagsHTML = entry.tags.map(tag => `<span class="badge">${tag}</span>`).join('');
    
    return `
      <li>
        <div class="entry-header">
          <div class="timestamp">${dateStr}</div>
          <div class="entry-actions">
            <button class="delete-btn" onclick="dashboard.deleteEntry('${sectionId}', ${entry.id})">
              ğŸ—‘ï¸ å‰Šé™¤
            </button>
          </div>
        </div>
        ${entry.tags.length > 0 ? `<div class="tags-container">${tagsHTML}</div>` : ''}
        <div class="entry-content">${entry.content}</div>
      </li>
    `;
  }

  // ã‚¨ãƒ³ãƒˆãƒªãƒ¼å‰Šé™¤
  deleteEntry(sectionId, entryId) {
    if (!confirm('ã“ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
    
    this.data[sectionId] = this.data[sectionId].filter(entry => entry.id !== entryId);
    this.saveData();
    this.renderHistory(sectionId);
    this.showToast('ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'info');
  }

  // æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
  performSearch() {
    const searchTerm = document.getElementById('search-input').value.toLowerCase();
    const tagFilter = document.getElementById('tag-filter-input').value.toLowerCase();
    
    this.sections.forEach(section => {
      const entries = this.data[section.id] || [];
      const filtered = entries.filter(entry => {
        const contentMatch = entry.content.toLowerCase().includes(searchTerm);
        const tagMatch = tagFilter === '' || entry.tags.some(tag => 
          tag.toLowerCase().includes(tagFilter)
        );
        return contentMatch && tagMatch;
      });
      
      this.renderFilteredHistory(section.id, filtered);
    });
  }

  renderFilteredHistory(sectionId, entries) {
    const historyContainer = document.getElementById(`${sectionId}-history`);
    
    if (entries.length === 0) {
      historyContainer.innerHTML = `
        <div class="empty-state">
          <svg viewBox="0 0 24 24">
            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
          </svg>
          <p>æ¤œç´¢æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“</p>
        </div>
      `;
      return;
    }

    historyContainer.innerHTML = entries.map(entry => this.createEntryHTML(entry, sectionId)).join('');
  }

  // ãƒ‡ãƒ¼ã‚¿ç®¡ç†æ©Ÿèƒ½
  exportAllData() {
    const exportData = {
      version: '2.0',
      timestamp: new Date().toISOString(),
      theme: this.currentTheme,
      data: this.data
    };
    
    const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `lifedashboard-backup-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    this.showToast('ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸï¼', 'success');
  }

  exportSection(sectionId) {
    const sectionData = this.data[sectionId] || [];
    const sectionName = this.sections.find(s => s.id === sectionId)?.name || sectionId;
    
    const exportData = {
      section: sectionName,
      timestamp: new Date().toISOString(),
      entries: sectionData
    };
    
    const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${sectionId}-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    this.showToast(`${sectionName}ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸï¼`, 'success');
  }

  importData() {
    document.getElementById('file-input').click();
  }

  handleFileImport(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const importedData = JSON.parse(e.target.result);
        
        if (importedData.version && importedData.data) {
          // å®Œå…¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«
          if (confirm('æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ')) {
            this.data = importedData.data;
            if (importedData.theme) {
              this.setTheme(importedData.theme);
            }
          }
        } else if (importedData.section && importedData.entries) {
          // ã‚»ã‚¯ã‚·ãƒ§ãƒ³å˜ä½“ãƒ•ã‚¡ã‚¤ãƒ«
          const sectionId = this.sections.find(s => s.name === importedData.section)?.id;
          if (sectionId) {
            if (confirm(`${importedData.section}ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã‹ï¼Ÿ`)) {
              this.data[sectionId] = importedData.entries;
            }
          }
        } else {
          throw new Error('ä¸æ­£ãªãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™');
        }
        
        this.saveData();
        this.loadSectionData();
        this.showToast('ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸï¼', 'success');
        
      } catch (error) {
        console.error('Import error:', error);
        this.showToast('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    };
    
    reader.readAsText(file);
    event.target.value = '';
  }

  createBackup() {
    const backupData = {
      version: '2.0',
      timestamp: new Date().toISOString(),
      theme: this.currentTheme,
      data: this.data,
      metadata: {
        totalEntries: Object.values(this.data).reduce((sum, entries) => sum + entries.length, 0),
        sections: Object.keys(this.data)
      }
    };
    
    const backupKey = `lifedashboard-backup-${Date.now()}`;
    localStorage.setItem(backupKey, JSON.stringify(backupData));
    
    this.showToast('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆã—ã¾ã—ãŸï¼', 'success');
  }

  clearAllData() {
    if (!confirm('å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) return;
    if (!confirm('æœ¬å½“ã«ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) return;
    
    this.data = {};
    this.saveData(false);
    this.loadSectionData();
    this.showToast('å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'info');
  }

  // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
  loadSectionData() {
    this.sections.forEach(section => {
      this.renderHistory(section.id);
    });
  }

  // è‡ªå‹•ä¿å­˜ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼
  showAutoSaveIndicator() {
    const indicator = document.getElementById('auto-save');
    indicator.classList.add('show');
    setTimeout(() => {
      indicator.classList.remove('show');
    }, 2000);
  }

  // ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥
  showToast(message, type = 'info') {
    const existingToast = document.querySelector('.toast');
    if (existingToast) {
      existingToast.remove();
    }

    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = message;
    
    // ã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´
    if (type === 'success') {
      toast.style.background = 'var(--gradient-success)';
    } else if (type === 'warning') {
      toast.style.background = 'var(--gradient-warning)';
    } else if (type === 'error') {
      toast.style.background = 'var(--accent-red)';
    }
    
    document.body.appendChild(toast);
    
    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    setTimeout(() => toast.classList.add('show'), 100);
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => toast.remove(), 400);
    }, 3000);
  }

  // ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°
  bindEvents() {
    // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ
    document.getElementById('theme-toggle').addEventListener('click', () => {
      this.toggleTheme();
    });

    // æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
    document.getElementById('search-input').addEventListener('input', () => {
      clearTimeout(this.searchTimeout);
      this.searchTimeout = setTimeout(() => this.performSearch(), 300);
    });

    document.getElementById('tag-filter-input').addEventListener('input', () => {
      clearTimeout(this.filterTimeout);
      this.filterTimeout = setTimeout(() => this.performSearch(), 300);
    });

    // ãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒœã‚¿ãƒ³
    document.getElementById('export-all').addEventListener('click', () => {
      this.exportAllData();
    });

    document.getElementById('import-data').addEventListener('click', () => {
      this.importData();
    });

    document.getElementById('create-backup').addEventListener('click', () => {
      this.createBackup();
    });

    document.getElementById('clear-all').addEventListener('click', () => {
      this.clearAllData();
    });

    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
    document.getElementById('file-input').addEventListener('change', (e) => {
      this.handleFileImport(e);
    });

    // è‡ªå‹•ä¿å­˜ï¼ˆå…¥åŠ›æ™‚ï¼‰
    document.addEventListener('input', (e) => {
      if (e.target.matches('textarea, .tag-input')) {
        clearTimeout(this.autoSaveTimeout);
        this.autoSaveTimeout = setTimeout(() => {
          // ä¸€æ™‚ä¿å­˜ï¼ˆä¸‹æ›¸ãï¼‰æ©Ÿèƒ½
          const sectionId = e.target.id.replace('-input', '').replace('-tags', '');
          const draftKey = `draft-${sectionId}`;
          const draftData = {
            content: document.getElementById(`${sectionId}-input`)?.value || '',
            tags: document.getElementById(`${sectionId}-tags`)?.value || '',
            timestamp: Date.now()
          };
          localStorage.setItem(draftKey, JSON.stringify(draftData));
        }, 1000);
      }
    });

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®ä¸‹æ›¸ãå¾©å…ƒ
    window.addEventListener('beforeunload', () => {
      this.sections.forEach(section => {
        const content = document.getElementById(`${section.id}-input`)?.value;
        const tags = document.getElementById(`${section.id}-tags`)?.value;
        if (content || tags) {
          const draftKey = `draft-${section.id}`;
          const draftData = { content, tags, timestamp: Date.now() };
          localStorage.setItem(draftKey, JSON.stringify(draftData));
        }
      });
    });
  }

  // ä¸‹æ›¸ãå¾©å…ƒ
  restoreDrafts() {
    this.sections.forEach(section => {
      const draftKey = `draft-${section.id}`;
      const draft = localStorage.getItem(draftKey);
      if (draft) {
        try {
          const draftData = JSON.parse(draft);
          const contentInput = document.getElementById(`${section.id}-input`);
          const tagsInput = document.getElementById(`${section.id}-tags`);
          
          if (contentInput && draftData.content) {
            contentInput.value = draftData.content;
          }
          if (tagsInput && draftData.tags) {
            tagsInput.value = draftData.tags;
          }
        } catch (error) {
          console.error('ä¸‹æ›¸ãå¾©å…ƒã‚¨ãƒ©ãƒ¼:', error);
        }
      }
    });
  }
}

// åˆæœŸåŒ–
let dashboard;
document.addEventListener('DOMContentLoaded', () => {
  dashboard = new LifeDashboard();
  
  // ä¸‹æ›¸ãå¾©å…ƒ
  setTimeout(() => {
    dashboard.restoreDrafts();
  }, 100);
});
</script>
</body>
</html>
